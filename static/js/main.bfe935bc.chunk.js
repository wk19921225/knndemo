(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{112:function(e,t,n){e.exports=n(208)},117:function(e,t,n){},122:function(e,t){},124:function(e,t){},156:function(e,t){},157:function(e,t){},199:function(e,t){},200:function(e,t){},201:function(e,t){},202:function(e,t){},203:function(e,t,n){},208:function(e,t,n){"use strict";n.r(t);var a=n(1),i=n.n(a),s=n(103),r=n.n(s),c=(n(117),n(37)),o=n(38),l=n(40),d=n(39),u=n(41),m=n(108),f=n(16),b=n(59),v=n(30),g=n.n(v),h=n(60),p=n(22),k=n(104),E=n.n(k),w=n(105),N=n(106),x=n(111),O=n(107),P=(n(203),!1),y=!1,j=!0,C=5,M=10,B=["normal","right","left","down","up"],I=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(l.a)(this,Object(d.a)(t).call(this))).bindPage=Object(h.a)(g.a.mark(function t(){return g.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.knn=O.a(),t.next=3,N.a();case 3:e.mobilenet=t.sent,e.start();case 5:case"end":return t.stop()}},t)})),e.start=function(){e.timer&&e.stop(),e.video.play(),e.timer=requestAnimationFrame(e.animate.bind(Object(p.a)(e)))},e.stop=function(){e.video.pause(),cancelAnimationFrame(e.timer)},e.animate=Object(h.a)(g.a.mark(function t(){var n,a,i,s,r,c,o,l,d;return g.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.videoPlaying){t.next=16;break}if(n=x.a.fromPixels(e.video),i=function(){return e.mobilenet.infer(n,"conv_preds")},-1!=e.training&&(a=i(),e.knn.addExample(a,e.training)),s=e.knn.getNumClasses(),!P){t.next=13;break}if(j=!1,!(s>0)){t.next=13;break}return a=i(),t.next=11,e.knn.predictClass(a,M);case 11:for(r=t.sent,c=0;c<C;c++)o=e.knn.getClassExampleCount(),r.classIndex==c&&y&&(console.log(e.controller),e.controller(B[r.classIndex])),o[c]>0&&e.setState(Object(b.a)({},"".concat(B[c],"Message"),"".concat(o[c],"\uff1a").concat(100*r.confidences[c],"%")));case 13:if(j)for(l=e.knn.getClassExampleCount(),d=0;d<C;d++)l[d]>0&&e.setState(Object(b.a)({},"".concat(B[d],"Message"),"".concat(l[d],"\u5f20\u6837\u672c")));n.dispose(),null!=a&&a.dispose();case 16:e.timer=requestAnimationFrame(e.animate.bind(Object(p.a)(e)));case 17:case"end":return t.stop()}},t)})),e.bindEvent=function(){var t=document.getElementsByClassName("trainBtn");if(t||t.length){console.log("\u7ed1\u5b9a\u4e8b\u4ef6");for(var n=function(n){var a=t[n];a.addEventListener("mousedown",function(){return e.training=n}),a.addEventListener("touchstart",function(){return e.training=n}),a.addEventListener("mouseup",function(){return e.training=-1}),a.addEventListener("touchend",function(){return e.training=-1})},a=0;a<t.length;a++)n(a)}},e.startTrain=function(){P=!0},e.startPredict=function(){y=!0,e.setState({showPredict:!0})},e.bindKeyboardEvent=function(){document.onkeydown=function(t){var n="";switch(t.keyCode){case 40:n="down";break;case 37:n="left";break;case 38:n="top";break;case 39:n="right"}console.log(n);var a=e.state.snakePoint,i=e.state.blockPoint,s=a[a.length-1];switch(n){case"down":s+=10;break;case"top":s-=10;break;case"left":s-=1;break;case"right":s+=1}if(s<100&&s>=0&&(a.shift(),a.push(s),console.log(a)),-1!==i.indexOf(s)){var r=i.indexOf(s);i.splice(r,1),a.unshift(a[0]-1)}e.setState({snakePoint:a,currIndex:s})},e.setState({showPredict:!0})},e.training=-1,e.videoPlaying=!1,e.controller=w.throttle(e.uniControl.bind(Object(p.a)(e)),1e3),console.log(e.controller),e.state={currIndex:2,snakePoint:[0,1,2],blockPoint:[9,24,95,69,52],showPredict:!1,smallBlockArr:Object.keys(Array.from({length:100})).map(function(e){return{id:parseInt(e),status:!1}}),rightMessage:"",leftMessage:"",downMessage:"",upMessage:"",normalMessage:""},e}return Object(u.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=this;navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(t){e.video&&(e.video.srcObject=t,e.video.width=300,e.video.height=300,e.video.addEventListener("playing",function(){return e.videoPlaying=!0}),e.video.addEventListener("paused",function(){return e.videoPlaying=!1}))}),this.bindEvent(),this.bindPage()}},{key:"uniControl",value:function(e){console.log(e);this.state.currIndex;switch(e){case"right":1;break;case"left":1;break;case"down":10;break;case"up":10;break;case"normal":0}var t=this.state.snakePoint,n=this.state.blockPoint,a=t[t.length-1];switch(e){case"down":a+=10;break;case"up":a-=10;break;case"left":a-=1;break;case"right":a+=1;break;case"normal":a+=0}if(a<100&&a>=0&&"normal"!=e&&(t.shift(),t.push(a),console.log(t)),-1!==n.indexOf(a)){var i=n.indexOf(a);n.splice(i,1),t.unshift(t[0]-1)}this.setState({snakePoint:t,currIndex:a})}},{key:"render",value:function(){var e=this,t=this.state,n=t.showPredict,a=t.smallBlockArr,s=t.rightMessage,r=t.leftMessage,c=t.normalMessage,o=t.downMessage,l=t.upMessage,d=t.currIndex,u=t.snakePoint,m=t.blockPoint;return i.a.createElement("div",{className:"enhance"},i.a.createElement("h6",null,"knn demo"),i.a.createElement("div",{className:"video-container"},i.a.createElement("video",{ref:function(t){e.video=t},autoPlay:!0,playsInline:!0})),!n&&i.a.createElement("div",{className:"train-block"},i.a.createElement("div",{className:"train-btn-group"},i.a.createElement("div",{className:"normal-content"},i.a.createElement("button",{id:"normal",className:"btn trainBtn"},"\u6b63\u5e38"),i.a.createElement("p",{className:"message"},c)),i.a.createElement("div",{className:"right-content"},i.a.createElement("button",{id:"right",className:"btn trainBtn"},"\u5411\u53f3"),i.a.createElement("p",{className:"message"},s)),i.a.createElement("div",{className:"left-content"},i.a.createElement("button",{id:"left",className:"btn trainBtn"},"\u5411\u5de6"),i.a.createElement("p",{className:"message"},r)),i.a.createElement("div",{className:"down-content"},i.a.createElement("button",{id:"down",className:"btn trainBtn"},"\u5411\u4e0b"),i.a.createElement("p",{className:"message"},o)),i.a.createElement("div",{className:"up-content"},i.a.createElement("button",{id:"up",className:"btn trainBtn"},"\u5411\u4e0a"),i.a.createElement("p",{className:"message"},l))),i.a.createElement("div",{className:"confirm-btn-group"},i.a.createElement("button",{className:"btn train",onClick:function(){e.startTrain()}},"\u8bad\u7ec3"),i.a.createElement("button",{className:"btn start",onClick:function(){e.startPredict()}},"\u5f00\u59cb"))),!!n&&i.a.createElement("div",{className:"predict-block"},i.a.createElement("div",null,d),i.a.createElement("div",{className:"predict"},a.map(function(e){return i.a.createElement("div",{key:e.id,className:E()(["small-block",{selected:-1!==u.indexOf(e.id),block:-1!==m.indexOf(e.id)}])})}))))}}]),t}(i.a.Component),A=function(e){function t(){return Object(c.a)(this,t),Object(l.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(u.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return i.a.createElement(m.a,null,i.a.createElement(f.a,{path:"/",component:I}))}}]),t}(i.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(i.a.createElement(A,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[112,1,2]]]);
//# sourceMappingURL=main.bfe935bc.chunk.js.map